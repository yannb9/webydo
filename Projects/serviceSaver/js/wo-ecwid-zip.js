function sortByDistance(e,a){return e.distance2<a.distance2?-1:e.distance2>a.distance2?1:0}function storeDistance(e,a,i,t,d){if(e==i&&a==t)return 0;var o=Math.PI*e/180,r=Math.PI*i/180,l=a-t,s=Math.PI*l/180,c=Math.sin(o)*Math.sin(r)+Math.cos(o)*Math.cos(r)*Math.cos(s);return c>1&&(c=1),c=60*(c=180*(c=Math.acos(c))/Math.PI)*1.1515,"K"==d&&(c*=1.609344),"N"==d&&(c*=.8684),c.toFixed(2)}function addDistance(e,a,i){for(var t in i){var d=i[t];jQuery.ajax({url:"https://api.zippopotam.us/us/"+d.zip,async:!1}).done(i=>{d.distance=storeDistance(a,e,i.places[0].latitude,i.places[0].longitude,"M"),d.distance2=Math.round(storeDistance(a,e,i.places[0].latitude,i.places[0].longitude,"M"))})}}function createModal(){jQuery("body").append("<div id='modal-overlay'><container id='modal-pop'><i class='fas fa-times'></i><div id='modal-loader'></div></container></div>"),jQuery("div#modal-overlay,container#modal-pop, div#modal-loader").fadeIn("slow"),jQuery("i.fas.fa-times").click(e=>{jQuery("div#modal-overlay").fadeOut("fast"),setTimeout(()=>{jQuery("div#modal-overlay").remove()},500)})}function ModalInvalidZip(){"block"==jQuery("div#modal-loader").css("display")&&(jQuery("div#modal-loader").hide(),jQuery("container#modal-pop").append("<h2>Sorry...</h2><p>I think you didn't enter a valid zip code</p></div>"))}function modalRowSetup(e){"block"==jQuery("div#modal-loader").css("display")&&(jQuery("div#modal-loader").fadeOut("fast"),jQuery("container#modal-pop").append("<h2> Locations Near You :</h2>"),e.forEach((e,a)=>{a<50&&(jQuery("container#modal-pop").append('<div class="rowModal"><div class="col1"></div><div class="col2"></div></div><div class="separator"></div>'),jQuery("div.col1").eq(a).append("<img src='"+e.image+"'>"),jQuery("div.col2").eq(a).append(e.description),jQuery("div.col2").eq(a).append('<div class="last"><span class="price">Price: '+e.price+'</span><a class="productInfo" href="'+e.url+'">View Product</a></div>'),jQuery("div#modal-overlay hr").remove())}))}var severalZips,ecwidData=[];jQuery.ajax({url:"https://app.ecwid.com/api/v3/15073053/products?enabled=true&token=public_Hja9xd4FtFsBgBLQyJTzhrjfeWaPb5Rp",async:!1}).done(e=>{e.items.forEach((e,a)=>{var i=ecwidData[a]={};i.title=e.name,i.description=e.description,i.image=e.thumbnailUrl,i.price=e.defaultDisplayedPriceFormatted,i.zip=e.attributes[0].value,i.url=[e.url.slice(0,e.url.indexOf("#!")),"Shop.html",e.url.slice(e.url.indexOf("#!"))].join("")})}),ecwidData.forEach((e,a)=>{e.zip.indexOf(", ")>-1&&(severalZips=e.zip.split(", "),e.zip=severalZips[0],severalZips.forEach((a,i)=>{var t={};if(null!=severalZips[i+1]){var d=severalZips[i+1].trim();ecwidData.push(t),t.title=e.title,t.description=e.description,t.image=e.image,t.price=e.price,t.zip=d,t.url=[e.url.slice(0,e.url.indexOf("#!")),"Shop.html",e.url.slice(e.url.indexOf("#!"))].join("")}}))}),jQuery("form#ecwid-se").submit(e=>{e.preventDefault(),createModal(),zipVal=jQuery("input#search-ecwid-se").val(),zipVal.length<5||zipVal.length>5?ModalInvalidZip():5==zipVal.length&&setTimeout(()=>{jQuery.ajax({url:"https://api.zippopotam.us/us/"+zipVal,async:!1}).done(e=>{addDistance(e.places[0].longitude,e.places[0].latitude,ecwidData)}),ecwidData.sort(sortByDistance),modalRowSetup(ecwidData),document.querySelectorAll("container#modal-pop p").forEach(e=>{e.textContent=e.textContent.slice(0,150),e.textContent+="..."})},1500)});
